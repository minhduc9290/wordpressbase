(function(e){function i(){e("#titlewrap #title, #post input").keydown(function(j){if(j.keyCode==13){j.preventDefault();return false}});e("#btn-save-header").click(function(k){k.preventDefault();var l=e(this);l.addClass("disabled");l.closest(".action-save").addClass("loading");var j=JSON.stringify(a(hb.model.toJSON()));e("#data-header").html(j);setTimeout(function(){e("#publish").trigger("click");var m=false;e(window).on("beforeunload",function(){m=true});setTimeout(function(){if(!m){e("#publish").trigger("click")}},1500)},500)})}function d(){var j=e(".post-type-header_builder .wrap .page-title-action");var k=j.attr("href");j.append('<div class="list-layout"><a href="'+k+'&layout=horizontal">Horizontal Layout</a><a href="'+k+'&layout=vertical">Vertical Layout</a></div>');j.click(function(l){l.stopPropagation();l.preventDefault();var m=e(this);m.toggleClass("active")});e(".post-type-header_builder .wrap .page-title-action").on("click","a",function(){var m=e(this);var l=m.attr("href");window.location.href=l});e(document).click(function(){var l=e(".post-type-header_builder .wrap .page-title-action.active");if(l.length){l.removeClass("active")}})}function a(j){e.each(j,function(k,l){if(e.inArray(k,["desktop","mobile"])!=-1){j[k]["settings"]=b(l.settings,wr_hb_data_allow.settings,true);e.each(l.rows,function(m,n){j[k]["rows"][m]=b(n,wr_hb_data_allow.rows,false);e.each(n.cols,function(p,o){j[k]["rows"][m]["cols"][p]=b(o,wr_hb_data_allow.cols,false);e.each(o.items,function(s,r){var q=r._rel;j[k]["rows"][m]["cols"][p]["items"][s]=b(r,wr_hb_data_allow.items[q],true)})})})}});return j}function b(k,l,j){e.each(k,function(m,n){if((typeof(l)==="object"&&l[m]==undefined)||n===null){delete k[m]}else{if(typeof(n)==="object"){if(Object.keys(n).length>0){k[m]=j?b(n,l[m],true):n}else{delete k[m]}}else{if(typeof(n)==="string"){n=n.trim();if(l[m]===n||n===""){delete k[m]}else{k[m]=n}}else{if(l[m]===n){delete k[m]}else{k[m]=n}}}}});return k}function c(){e("#the-list").on("click",".hb-set-default:not(.loading)",function(){var j=confirm("Do you really want to set this header by default?");if(!j){return}var l=e(this);var k=l.attr("data-id");l.addClass("loading");l.append('<img class="loading-img" src="images/spinner.gif" />');e.ajax({type:"POST",url:wr_site_data.ajax_url,data:{action:"set_to_default",header_id:k,_nonce:wr_site_data._nonce},success:function(n){if(n){n=e.parseJSON(n);if(n.status=="true"){var m=l.closest("table").find(".hb-default");l.text("Default");m.text("Set to default");m.addClass("hb-set-default").removeClass("hb-default");l.addClass("hb-default").removeClass("hb-set-default");l.find(".loading-img").remove();l.removeClass("loading");return}}location.reload()}})});e(".settings-library").on("click",".setting-item.set-default",function(){var j=confirm("Do you really want to set this header by default?");if(!j){return}var l=e(this);var k=e("#hb-app").attr("data-id");l.removeClass("set-default");l.addClass("loading");e.ajax({type:"POST",url:wr_site_data.ajax_url,data:{action:"set_to_default",header_id:k,_nonce:wr_site_data._nonce},success:function(m){if(m){m=e.parseJSON(m);if(m.status=="true"){l.removeClass("loading");l.addClass("disabled");l.attr("title","Default")}}}})})}function f(){e(".hb-wrapper .add-new-header").click(function(){var j=e(this);if(j.hasClass("active")){j.removeClass("active");j.next(".select-layout").hide()}else{j.addClass("active");j.next(".select-layout").show()}return false});e(document).click(function(){var j=e(".hb-wrapper .add-new-header");j.removeClass("active");j.next(".select-layout").hide()})}function h(){e("body").on("click",".wr-delete",function(){var j=confirm("Are you sure delete?");if(!j){return false}})}function g(){e("body").on("click",".duplicate:not(.loaded)",function(){var l=e(this);var k=l.closest("tr");var j=k.attr("data-id");l.addClass("loaded");l.append('<img class="loading" src="images/spinner.gif" />');e.ajax({type:"POST",url:wr_site_data.ajax_url,data:{action:"duplicate",header_id:j,_nonce:wr_site_data._nonce},success:function(n){if(n){n=e.parseJSON(n);if(n.status=="true"){l.removeClass("loaded");l.find(".loading").remove();var m=k.html().replace(new RegExp(j,"g"),n.header_id);k.after('<tr class="row-duplicate" data-id="'+n.header_id+'">'+m+"</tr>");e(".row-duplicate .title a").text(n.header_new_name);e(".row-duplicate .author-create").text(n.author);e(".row-duplicate .time-create").html(n.time_create);if(k.hasClass("hb-default")){e(".row-duplicate").removeClass("hb-default");e(".row-duplicate .action-default").text("Set to default")}e(".row-duplicate").removeClass("row-duplicate");return}}location.reload()}})})}e(document).ready(function(){d();i();f();c();g();h()})})(jQuery);